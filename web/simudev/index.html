<html>
   <head>
      <title>JavaScript MQTT WebSocket Example</title>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
	 </script>
	 <script type = "text/javascript" language = "javascript">
		var mqtt;
		var reconnectTimeout = 2000;
		var host="liveobjects.orange-business.com"; //change this
		var port=80;
		var client_id="urn:lo:nsid:flexy205:JBP0475410668"
		let payload = {
			"s":client_id+'!uplink',
			"m":"Flexy205",
			"value":{
				"variable" : "toto",
				"valeur" : "titi"
			},
			"loc":[45.759723,4.84223],
			"ts": "22Z"
		}
		function onFailure(message) {
			console.log("Connection Attempt to Host "+host+"Failed");
			setTimeout(MQTTconnect, reconnectTimeout);
        }
		function onMessageArrived(msg){
			out_msg="Message received "+msg.payloadString+"<br>";
			out_msg=out_msg+"Message received Topic "+msg.destinationName;
			console.log(out_msg);

		}
		function onConnectionLost(){
			console.log("connection lost");
		}
	 	function onConnect() {
	  // Once a connection has been made, make a subscription and send a message.

		console.log("Connected ");
		mqtt.subscribe("dev/cmd");
		console.log("Sending "+ JSON.stringify(payload))
		message = new Paho.MQTT.Message(JSON.stringify(payload));
		//message.destinationName = "sensor1";
		//mqtt.send(message);
	  }
	  function MQTTconnect() {
		console.log("connecting to "+ host +" "+ port);
		mqtt = new Paho.MQTT.Client(host,port,client_id);
		//document.write("connecting to "+ host);
		//mqtt.tls_set('c:/python34/steve/mqtt-demos/certs/ca.crt')
		var options = {
			useSSL:false,
			timeout: 3,
			userName:"json+device",
			password:"INSERT API_KEY HERE",
			onSuccess: onConnect,
			onFailure: onFailure

		 };
		mqtt.onConnectionLost = onConnectionLost;
		mqtt.onMessageArrived = onMessageArrived
		mqtt.connect(options); //connect
		}

	  </script>
   </head>
     <body>
   <h1>Main Body</h1>
 	<script>
	MQTTconnect();
	</script>
   </body>
</html>
